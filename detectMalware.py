import hashlib
import pytz
import os
import time
import subprocess

def push():
    subprocess.call("rm -rf /media/ais/Data/reconstruction_file/*", shell=True)
    subprocess.call("sudo tcpxtract -f  behaviour.pcap -o /media/ais/Data/reconstruction_file/", shell=True)
    time.sleep(5)
    output = subprocess.Popen("clamscan /media/ais/Data/reconstruction_file/", stdout=subprocess.PIPE, shell=True).stdout.read()
    print(output)
    if "SCAN SUMMARY" in output and "Infected files: 0" not in output:
	    call(["node", "/home/ais/Desktop/test2.js"])

filehash = hashlib.md5()
filehash.update(open('behaviour.pcap', 'rb').read())
push()
print(filehash.hexdigest())
has = filehash.hexdigest()
while (1):
    newhash = hashlib.md5()
    newhash.update(open('behaviour.pcap', 'rb').read())
    if newhash.hexdigest() != has:
        push()
        has = newhash.hexdigest()
        print("file changed!")
    time.sleep(30)
